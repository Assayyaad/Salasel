# Multilingual System Documentation

This document explains how to use the internationalization (i18n) system in the Salasel Next.js app.

## Overview

The app supports multiple languages with:

- Language code (ar, en, ja, etc.)
- Language name (العربية, English, 日本語, etc.)
- Text direction (rtl, ltr)

Default language: **Arabic (ar)**

All routes are prefixed with the language code (e.g., `/ar/`, `/en/`, `/ja/`).

## File Structure

```
app/
  types.ts           # All TypeScript types including i18n types
  static.ts          # Language configuration and translation map
  translate.ts       # Translation utility functions
  [lang]/            # Language-specific routes
    layout.tsx       # Language-aware layout
    (home)/
    playlist/
i18n/
  schema.json              # Translation schema (defines required keys and descriptions)
  ar.json            # Arabic translations
  en.json            # English translations
  ja.json            # Japanese translations
middleware.ts        # Redirects to default language
```

## Adding a New Language

1. **Update `app/types.ts`:**

   ```typescript
   export type LanguageCode = 'ar' | 'en' | 'ja' | 'fr' // Add 'fr'
   ```

2. **Update `app/static.ts`:**

   ```typescript
   export const allLanguages: Readonly<Language[]> = Object.freeze([
     { code: 'ar', name: 'العربية', dir: 'rtl' },
     { code: 'en', name: 'English', dir: 'ltr' },
     { code: 'ja', name: '日本語', dir: 'ltr' },
     { code: 'fr', name: 'Français', dir: 'ltr' }, // Add French
   ])

   export const translationsMap: Readonly<Record<LanguageCode, Translations>> = Object.freeze({
     ar: require('../i18n/ar.json'),
     en: require('../i18n/en.json'),
     ja: require('../i18n/ja.json'),
     fr: require('../i18n/fr.json'), // Add French
   })
   ```

3. **Update `app/types.ts` Translations interface:**
   Add 'fr' to any union types if needed.

4. **Create `i18n/fr.json`:**
   Copy structure from `ar.json` and translate all keys according to `i18n/schema.json` schema.

## Using Translations

### In Server Components

```tsx
import { getTranslations } from '@/app/translate'

export default function MyPage({ params }: { params: { lang: string } }) {
  const t = getTranslations(params.lang)

  return (
    <div>
      <h1>{t.appTitle}</h1>
      <p>{t.appDescription}</p>
    </div>
  )
}
```

### In Client Components

Pass translations as props from server component:

**ServerComponent.tsx:**

```tsx
import { getTranslations } from '@/app/translate'
import ClientComponent from './ClientComponent'

export default function ServerComponent({ params }: { params: { lang: string } }) {
  const t = getTranslations(params.lang)

  return <ClientComponent t={t} />
}
```

**ClientComponent.tsx:**

```tsx
'use client'

import type { Translations } from '@/app/types'

export default function ClientComponent({ t }: { t: Translations }) {
  return <button>{t.notesSaveButton}</button>
}
```

### Type-Safe Translation Function

```tsx
import { createT, getTranslations } from '@/app/translate'

const translations = getTranslations('ar')
const t = createT(translations)

// Fully type-safe - autocomplete works!
const title = t('appTitle')
const loading = t('loading')
```

### Getting Language Configuration

```tsx
import { getLanguage } from '@/app/translate'

const lang = getLanguage('ar')
console.log(lang.name) // 'العربية'
console.log(lang.dir) // 'rtl'
```

## Translation Schema

The `i18n/.json` file defines all required translation keys using JSON Schema with descriptions. All language files must include these keys.

To add a new translation key:

1. Add it to `i18n/.json` schema with a descriptive comment
2. Update the `Translations` interface in `app/types.ts`
3. Add the translation to all language files (`ar.json`, `en.json`, `ja.json`)

Example schema entry:

```json
{
  "properties": {
    "myNewKey": {
      "type": "string",
      "description": "Label for the new feature button"
    }
  }
}
```

## Metadata and SEO

The `[lang]/layout.tsx` automatically generates:

- Correct `lang` attribute on `<html>`
- Correct `dir` attribute (rtl/ltr)
- `alternates.languages` for all supported languages
- `openGraph.locale` and `openGraph.alternateLocale`

Example output:

```html
<html lang="ar" dir="rtl">
  <head>
    <link rel="alternate" hreflang="ar" href="https://salasel.app/ar" />
    <link rel="alternate" hreflang="en" href="https://salasel.app/en" />
    <link rel="alternate" hreflang="ja" href="https://salasel.app/ja" />
  </head>
</html>
```

## Middleware

The `middleware.ts` automatically redirects users from `/` to `/ar/` (default language).

URLs without language prefix are automatically redirected:

- `/` → `/ar/`
- `/playlist/123` → `/ar/playlist/123`

## URL Structure

All routes must include the language code:

- ✅ `https://salasel.app/ar/`
- ✅ `https://salasel.app/en/playlist/abc123`
- ✅ `https://salasel.app/ja/playlist/abc123/video456`
- ❌ `https://salasel.app/` (redirects to `/ar/`)
- ❌ `https://salasel.app/playlist/abc123` (redirects to `/ar/playlist/abc123`)

## Best Practices

1. **Never hardcode text** - Always use translations from `getTranslations()`
2. **Type safety** - Use the `Translations` type for props
3. **Schema first** - Add keys to schema before using them
4. **Consistent translations** - Keep the same tone across languages
5. **RTL support** - Test with Arabic to ensure proper RTL layout
6. **Link generation** - Always include the `lang` parameter in links:
   ```tsx
   <Link href={`/${params.lang}/playlist/${id}`}>...</Link>
   ```

## API Reference

### `getLanguage(code: string): Language`

Returns language configuration. Falls back to default language if invalid.

```tsx
const lang = getLanguage('en')
// Returns: { code: 'en', name: 'English', dir: 'ltr' }
```

### `isValidLanguage(code: string): boolean`

Checks if a language code is supported.

```tsx
isValidLanguage('ar') // true
isValidLanguage('fr') // false
```

### `getTranslations(lang: string): Translations`

Loads translations for a language. Falls back to default language if invalid.

```tsx
const t = getTranslations('en')
console.log(t.appTitle) // 'Salasel'
```

### `createT(translations: Translations)`

Creates a type-safe translation function.

```tsx
const t = createT(getTranslations('ar'))
const title = t('appTitle') // Type-safe!
```

### `getLanguages(): readonly Language[]`

Returns array of all supported languages.

```tsx
const languages = getLanguages()
// [{ code: 'ar', ... }, { code: 'en', ... }, { code: 'ja', ... }]
```

### `getDefaultLanguage(): Language`

Returns the default language configuration.

```tsx
const defaultLang = getDefaultLanguage()
// { code: 'ar', name: 'العربية', dir: 'rtl' }
```

## Migration from Old System

If you're migrating from hardcoded strings in `app/static.ts`:

### Before (deprecated):

```tsx
import { searchPlaceholder, loading } from '@/app/static'

function MyComponent() {
  return <input placeholder={searchPlaceholder} />
}
```

### After (recommended):

```tsx
import { getTranslations } from '@/app/translate'

function MyComponent({ params }: { params: { lang: string } }) {
  const t = getTranslations(params.lang)
  return <input placeholder={t.searchPlaceholder} />
}
```

## Static vs Dynamic Content

- **Static content** (UI labels, buttons, messages): Use i18n translations
- **Dynamic content** (playlist titles, video descriptions): Store in database with language field
- **Categories**: Currently hardcoded in Arabic. Consider adding to translations if needed for other languages

## Common Patterns

### Conditional Content Based on Language

```tsx
const lang = getLanguage(params.lang)

if (lang.code === 'ar') {
  // Arabic-specific logic
} else {
  // Other languages logic
}
```

### Nested Object Translation

```tsx
const t = getTranslations(params.lang)

// Access nested translations
const contentTypes = [t.contents[0], t.contents[1], t.contents[2]]
const presentations = [t.presentations[0], t.presentations[1], t.presentations[2], t.presentations[3]]
```

### Language Switcher Component

```tsx
import { getLanguages } from '@/app/translate'
import Link from 'next/link'

export function LanguageSwitcher({ currentLang }: { currentLang: string }) {
  const languages = getLanguages()

  return (
    <div>
      {languages.map((lang) => (
        <Link key={lang.code} href={`/${lang.code}`}>
          {lang.name}
        </Link>
      ))}
    </div>
  )
}
```
